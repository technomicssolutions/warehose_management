{% extends 'base.html' %}

{% block body_id %}create_sales{% endblock %}

{% block title %}Sales-DeliveryNote {% endblock title %}
{% block controller %}ng-controller="SalesDNController" ng-init="init('{{csrf_token}}', '{{sales_invoice_number}}')" ng-click="hide_sales_details()"{% endblock controller %}
{% block dialogue_popup %}
	{% include 'add_new_customer.html' %} 
	              	
{% endblock %}

{% block content %}

	<div id="main-title">
		<div class="alert alert-info" align="Center"><h4>Sales Entry</h4></div>
	</div>

	<div class="sales_form_container">
		<form name="sales_entry" method="post">
			<div class="form_contents_sales">
				<div class="section_1_sales">
					
					<div class="formrow_sales">
						<div class="formtext_sales	">
							<label for="Date ">Date </label>
						</div>

						<div class="forminput_sales">
							
							<input type="text" name="sales_invoice_date"  id="sales_invoice_date" value="">
						</div>
					</div>
					<div class="formrow_sales">
						<div class="formtext_sales">
							<label for="salesman">Salesman Name</label>
						</div>
						<div class="forminput_sales">
							<select name="customer" ng-model="sales.salesman">
								<option value="select">Select</option>
								<option ng-repeat="salesman in salesmen" value="[[salesman.salesman_name]]" ng-selected="salesman.salesman_name == sales.salesman">[[salesman.salesman_name]]
								</option>
							</select>							
						</div>
						<p class="error_message">[[salesman_validation_error]]</p>
					</div>

					<div class="formrow_sales">
						<div class="formtext_sales">
							<label for="sales_invoice_number">Invoice Number </label>
						</div>
						<div class="forminput_sales">
							<input type="text" name="sales_invoice_number"  ng-model="sales.sales_invoice_number" ng-change="is_sales_invoice_exists()" / >
						</div>
						<p class="error_message">[[existance_message]]</p>
					</div>	

					<div class="formrow_sales">
						<div class="formtext_sales">
							<label for="lpo_number">LPO Number </label>
						</div>
						<div class="forminput_sales">
							<input type="text" name="lpo_number"  ng-model="sales.lpo_number"/ >
						</div>
					</div>

				</div>	

				<div class="section_3_sales">
					<div class="search_sales">
						<div class="control">
							<label> Item Code </label>
   							<input type='text' id="item_code" ng-model="item_code" ng-change="getItems('item_code')"/>
   						</div>
   						<div class="control">
   							<label> Item name </label>
   							<input type="text" id='item_name' ng-model="item_name" ng-change="getItems('item_name')"/>
   						</div>
   						<div class="control">
   							<label> Barcode </label>
   							<input type="text" id='barcode' ng-model="barcode" ng-change="getItems('barcode')"/>
   						</div>
   						<div class="clear"></div>
	   					<div class="item_list" ng-show='selecting_item' ng-hide="item_selected">
							<div class="item_list_row header">
								<span> Item Code </span>
								<span> Item name </span>
								<span> Barcode </span>
							</div>
							<div ng-repeat="item in items" ng-click="addSalesItem(item)" class="item_list_row">
								
								<span>[[item.code_of_item]]</span>
								<span>[[item.item_name]]</span>
								<span>[[item.barcode]] </span>
							</div>
							<div class="clear"></div>
						</div>
    				</div>
    				<div class="clear"></div>
   				</div>
				
			
   				<div class="purchase_items_list" ng-show="sales.sales_items.length > 0">
   					<div class="purchase_item_list">
   						
   						<div class="item_list_row header">
							<span class="small_column"> Item Code </span>
							<span> Item Name </span>
							<span> Total Quantity </span>
							<span> Unit Price </span>
							<span> Qty Sold </span>
							<span> Remaining </span>
							<span> Qty </span>	
							<span> Dis Amt</span>
							<span> Dis(%) </span>
							
							<span> Net Amount </span>
							<span> &nbsp;&nbsp; </span>
						</div>
						<div ng-repeat="item in sales.sales_items" class="item_list_row">
							<span class="small_column">[[item.item_code]] </span>
							<span>[[item.item_name]] </span>
							<span>[[item.current_stock]] </span>
							<span><input type="text" ng-model="item.unit_price" ng-change="calculate_net_amount_sale(item)" /> </span>
							<span>[[item.qty_sold]]</span>
							<span>[[item.remaining_qty]]</span> 
							<span> <input type="text" ng-model="item.qty" ng-change="calculate_net_amount_sale(item)" /> </span>
							<span> <input type="text" ng-model="item.dis_amt" ng-change="calculate_discount_percent(item)" /> </span>
							<span> <input type="text" ng-model="item.dis_percentage" ng-change="calculate_discount_amt(item)" /> </span>
							<span>[[item.net_amount]] </span>
							<span><a href="" ng-click="remove_from_item_list(item)">X</a> </span>
							 
						</div>
						
						<div class="clear"></div>
   					</div>
   					<div class="clear"></div>
   				</div>

   				<div class="section_3_sales align_top">
					<div class="search_sales">
	   					<div class="item_list" ng-show='sales_deatils' id="latest_sales_details" ng-click="hide_sales_details()">
							<div class="item_list_row header" ng-click="hide_sales_details()">
								<span> Date </span>
								<span> Unit Price </span>
								<span> Quantity Sold </span>
								<span> Discount Given </span>
							</div>
							<div ng-repeat="sales_item in latest_sales" ng-click="hide_sales_details()" class="item_list_row" id="latest_sales_details">
								<span>[[sales_item.date]]</span>
								<span>[[sales_item.selling_price]]</span>
								<span>[[sales_item.qty_sold]]</span>
								<span>[[sales_item.discount_given]]</span>
							</div>
							<div class="clear"></div>
						</div>
    				</div>
    				<div class="clear"></div>
   				</div>
   				
   				<div class="clear"></div>

				<div class="section_1_sales">
					<div class="formrow_sales">
						<div class="formtext_sales">
							<label for="customer">Customer name</label>
						</div>
						<div class="forminput_sales">
							<select name="staff" ng-model="custmer_name" ng-change="add_customer()" >
								<option value="select">Select</option>
								<option ng-repeat="customer in customers">[[customer.customer_name]]</option>
								<option value="other">Other</option>
								
							</select>
						</div>
					
						<div class="formtext_sales" id="radio">
							<label for="payment_mode">Payment Mode</label>
						</div>
						<div class="forminput_sales" id="radio_input">
							<input type="radio" name="payment_mode" ng-model="sales.payment_mode" value="cash" ng-change="payment_mode_change_sales('cash')"><label>Cash</label>
							<input type="radio" name="payment_mode" ng-model="sales.payment_mode" value="cheque" ng-change="payment_mode_change_sales('cheque')"><label>Cheque</label>
							<input type="radio" name="payment_mode" ng-model="sales.payment_mode" value="credit" ng-change="payment_mode_change_sales('credit')"><label>Credit</label>

						</div>
					
						<!-- <div class="formtext_sales">
							<label for="card_number">Card Number</label>
						</div> -->
						<!-- <div class="forminput_sales">
							<input type="text" name="card_number"ng-model="sales.card_number" ng-readonly="payment_mode_selection">
						</div> -->
						<div class="formtext_sales">
							<label for="bank_name">Bank Name</label>
						</div>
						<div class="forminput_sales">
							<input type="text" name="bank_name"ng-model="sales.bank_name" ng-readonly="payment_mode_selection_check">
						</div>

					</div>
					

					<div class="formrow_sales">
						<div class="formtext_sales">
							<label for="net_total">Net Total</label>
						</div>
						<div class="forminput_sales">
							<input type="text" name="net_total"ng-model="sales.net_total" readonly/ >
						</div>
						<div class="formtext_sales">
							<label for="discount">Itemwise Discount</label>
						</div>
						<div class="forminput_sales">
							<input type="text" name="net_discount" ng-model="sales.net_discount"ng-change="calculate_grant_total_sale()" readonly/>
						</div>

						<div class="formtext_sales">
							<label for="discount">Discount for sale</label>
						</div>
						<div class="forminput_sales">
							<input type="text" name="net_discount" ng-model="sales.discount_sale"ng-change="calculate_discount_sale_percentage()"/>
						</div>
					
						<div class="formtext_sales">
							<label for="discount">Discount for sale percentage</label>
						</div>
						<div class="forminput_sales">
							<input type="text" name="net_discount" ng-model="sales.discount_sale_percentage" ng-change="calculate_discount_sale_amt()"/>
						</div>
					
						<div class="formtext_sales">
							<label for="round">Round Off</label>
						</div>
						<div class="forminput_sales">
							<input type="text" name="roundoff" ng-model="sales.roundoff" ng-change="calculate_grant_total_sale()">
						</div>

						<div class="formtext_sales">
							<label for="Grant Total">Grand Total</label>
						</div>
						<div class="forminput_sales">
							<input type="text" name="grant_total" ng-model="sales.grant_total" readonly/>
						</div>

						<div class="formtext_sales">
							<label for="paid">Paid</label>
						</div>
						<div class="forminput_sales">
							<input type="text" name="paid" ng-model="sales.paid" ng-change="calculate_balance_sale()">
						</div>

						<div class="formtext_sales">
							<label for="balance">Balance</label>
						</div>
						<div class="forminput_sales">
							<input type="text" name="balance" ng-model="sales.balance">
						</div>
					</div>
				</div>
			</div>
			<div  align="Center">
				<div class="buttons">
					<p class="error_message"> [[validation_error]] </p>
					<input type="button" value="Submit" ng-click="save_sales();">
					<a href="{% url 'home' %}"><input type="button" value="Cancel"></a>
				</div>
			</div>			
		</form>
		<div class="clear"></div>
	</div>

{% endblock content %}